<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Appendix H. User Defined Functions</title><link rel="stylesheet" href="fpa-style.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /><link rel="start" href="index.html" title="Forecast Production Assistant Version 8" /><link rel="up" href="index.html" title="Forecast Production Assistant Version 8" /><link rel="prev" href="apgs02.html" title="G.2. Configuration Files Block" /><link rel="next" href="aphs01.html" title="H.1. Testing and Installing the user library" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix H. User Defined Functions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="apgs02.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="aphs01.html">Next</a></td></tr></table><hr /></div><div class="appendix" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="appendh"></a>Appendix H. User Defined Functions</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="aphs01.html">H.1. Testing and Installing the user library</a></span></dt><dt><span class="section"><a href="aphs02.html">H.2. Writing user defined rules in python</a></span></dt></dl></div><p>
<a id="id2024534" class="indexterm"></a>
The directory <code class="filename"><code class="envar">$FPA</code>/templates/userlib</code> contains template files (<span class="acronym">ANSI-C</span> source, scripts and makefiles) for building your own local client-written library, that can be accessed by <span class="acronym">FPA</span> applications.
</p><p>
Do not modify the original files found in <code class="filename"><code class="envar">$FPA</code>/templates</code>.
These files will be updated with future releases and patches.
It is intended that you copy them to a convenient directory, and build the library there.
The script copyuserlib has been provided for this purpose.
</p><p>
This directory should contain the following files:
</p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><thead><tr><th>File name</th><th>Description</th></tr></thead><tbody><tr valign="top"><td valign="top"><code class="filename">README</code></td><td valign="top">File describing the contents of the directory</td></tr><tr valign="top"><td valign="top"><span><strong class="command">copyuserlib</strong></span></td><td valign="top">script to copy the template files to a working directory</td></tr><tr valign="top"><td valign="top"><code class="filename">user_rules.c</code></td><td valign="top">source template for rules to calculate attribute values</td></tr><tr valign="top"><td valign="top"><code class="filename">user_confirm.c</code></td><td valign="top">to confirm that the correct user defined library is being accessed</td></tr><tr valign="top"><td valign="top"><code class="filename">user_values.c</code></td><td valign="top">source template for value calculations</td></tr><tr valign="top"><td valign="top"><code class="filename">user_winds.c</code></td><td valign="top">source template for wind calculations</td></tr><tr valign="top"><td valign="top"><span><strong class="command">libmake</strong></span></td><td valign="top">script to build library</td></tr><tr valign="top"><td valign="top"><span><strong class="command">libput</strong></span></td><td valign="top">script to place library where it can be accessed</td></tr><tr valign="top"><td valign="top"><span><strong class="command">librestore</strong></span></td><td valign="top">script to restore the previous version of the library for use by
the operational <span class="acronym">FPA</span> software</td></tr><tr valign="top"><td valign="top"><code class="filename">Makefile.lib</code></td><td valign="top">make file used by libmake</td></tr></tbody></table></div><p>
Once you have copied the template files to a convenient working directory, instructions for writing your own functions are given inside the individual ".c" files.
</p><div class="variablelist"><dl><dt><span class="term">Version Confirmation</span></dt><dd><p>
The source file <code class="filename">user_confirm.c</code> is designed to confirm that the correct user defined library is connected.
With each new major release of your library you should set an identifying message here.
When the library is invoked this message will appear amongst the other startup messages in the log.
This allows you to confirm functions in your new library are indeed being invoked.
You can also set flags for displaying rules, value functions, and wind functions in the log.
A flag set to <code class="computeroutput">FALSE</code> implies that module does not need to be displayed in the startup message.
</p></dd><dt><span class="term">User defined Rules</span></dt><dd><p>
The source file <code class="filename">user_rules.c</code> is designed to access user defined routines to determine attributes for meteorological fields.
To add a new rule, you must follow the steps documented in the file: Add a prototype for the rule, add the rule to the rule table and finally add the code to calculate the rule.
The template file contains three sample rules: clds_and_wx_rule, full_weather_rule, and full_cloud_rule.
</p></dd><dt><span class="term">User defined value functions</span></dt><dd><p>
The source file <code class="filename">user_values.c</code> was designed to access user defined routines to extract values from fields of meteorological data.
There is one example routine for value extraction called <code class="function">values_for_values()</code>.
It gives an example of how data can be calculated by passing values to a function that the user would supply.
</p></dd><dt><span class="term">User defined wind functions</span></dt><dd><p>
The source file <code class="filename">user_winds.c</code> was designed to access user defined routines to extract wind speed and direction from fields of meteorological data.
There are three example routines given for winds extraction: <code class="function">winds_from_equations()</code> gives an example of winds calculated using a generic equation from the configuration files; <code class="function">winds_from_values()</code> gives an example of winds calculated by passing values to a function that the user would supply; <code class="function">gradient_wind_function()</code> gives an alternate way to calculate a gradient wind, using a more complicated function call rather than the equations given in the configuration files.
This last function also allows a cross isobaric estimate to be added.
</p></dd></dl></div><p>
</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="apgs02.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="aphs01.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">G.2. Configuration Files Block </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> H.1. Testing and Installing the user library</td></tr></table></div></body></html>
